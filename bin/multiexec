#!/usr/bin/env bash
# Author: qaraluch - 07.2018 - MIT

readonly PROG_NAME=$(basename $0)
# readonly PROG_DIR=$(readlink -m $(dirname $0))
readonly ARGS="$@"
readonly TIME_STAMP=$(date +%s)

printUsage() {
  cat <<EOL
${PROG_NAME} - Execute multiple commands from file.

Usage:
    ${PROG_NAME} commands.txt
EOL
  exit $1
}

parseOptions(){
    while [[ $# -gt 0 ]]
    do
    key="$1"
    case $key in
        # -t)
        # TO="-t" # uses longiness
        # shift 
        # ;;
        -h|--help)
        printUsage 1
        ;;
        *)                  # unknown option
        POSITIONAL+=("$1") 
        shift 
        ;;
    esac
    done
}

isEmpty() {
    local var=$1
    [[ -z $var ]]
}

ifNoArgsPrintUsage(){
  isEmpty $1 \
      && printUsage 1
}

getFileName(){
    local path=$1
    echo "${path##*/}"
}

main() {
    # var default
    # local TO="-to"
    local POSITIONAL=()
    ifNoArgsPrintUsage $ARGS
    parseOptions $ARGS
    set -- "${POSITIONAL[@]}"
    local CMDSFILE=$1
    local LOGFILENAME=$(getFileName $CMDSFILE)
    # echo TO = "${TO}"
    # echo CMDSFILE = "${CMDSFILE}"
    xargs -0 -n 1 bash -c < <(tr \\n \\0 < $CMDSFILE) 2>&1 > "${LOGFILENAME}-${TIME_STAMP}.log"
}

main
